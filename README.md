# 景观设计文本排版工具

## 项目目标
帮助景观设计师快速生成、整理设计文案，并以 1:1 预览 InDesign 页面版式，最终导出 IDML 文件供 InDesign 2024 直接打开。

---

## 文件说明

| 文件 | 说明 |
|------|------|
| `index_v2.html` | **当前主版本**（v2，推荐使用） |
| `index.html` | 旧版本（保留备份，可独立运行） |
| `README.md` | 本文档 |
| `CLAUDE.md` | AI 助手配置 |

---

## v2 使用方法（index_v2.html）

1. 用 Chrome 直接打开 `index_v2.html`
2. 点击右上角「设置」，填入 DeepSeek API Key
3. **STEP 1 · 项目信息**：粘贴原始资料（任务书/规划指标/建筑说明），可直接拖入 TXT / PDF 文件，或 Ctrl+V 粘贴截图
4. 点击「AI 一键提取信息 · 生成全套文案」→ AI 自动提取项目信息并生成所有章节内容
5. 切换到各章节标签查看内容，可通过对话进一步调整，点击「应用到预览」更新右侧预览
6. 点击顶部「导出 IDML」→ 下载 `.idml` 文件 → 在 InDesign 中 File → Open 打开

---

## v2 核心功能

### 可组合章节模块
- **前期分析**：区位分析 / 场地现状 / 建筑分析 / 工程概况（统计筛选型，从原始资料提取）
- **设计策略**：3~5 条策略点（逻辑推导型，重要项目才选）
- **设计构思**：设计构思 + 设计理念（创意型，AI 发挥）

### AI 工作流
- 一次性输入原始资料 → 一次 API 调用生成全套文案（不分步操作）
- 各章节支持独立对话式调整
- 支持拖入 PDF 自动提取文字（文字版 PDF，扫描版需截图）

### IDML 导出
- 只导出已应用内容的章节，页数自动匹配
- 各章节对应固定版式布局（区位：左图右文 / 场地：网格图右文 / 建筑：左文右图 / 策略：左图右列表 / 构思：2×2网格叠文字 / 理念：上文下图）
- A3 横向 420×297mm，Microsoft YaHei 字体，CMYK 颜色

---

## 页面规格

- 页面尺寸：A3 横向 420×297mm
- 页边距：四边均为 20mm
- InDesign 版本：19.0（兼容 InDesign 2024）

---

## 已修复的 IDML 问题（调试记录）

1. `designmap.xml` 含非法属性 → 已删除
2. `DOMVersion="20.0"` 超出支持范围 → 改为 `"19.0"`
3. `<Br/>` 位置错误 → 已修复
4. 同一 Story 被多个文字框引用 → 每页独立 Story
5. 缺少 `StoryList` 属性 → 已补全
6. `Graphic.xml` 颜色未定义 → 已添加 CMYK 颜色定义
7. 图片框含非法子节点 → 已移除
8. 删除 MasterSpread → 改用 `AppliedMaster="n"`
9. `Styles.xml` 根样式缺 `BasedOn` → 已补全
10. IDML 于 InDesign 2024 测试通过（2026-02-26）

---

## 待完成

- [ ] 版式精细调整（字体大小、行距、版面比例优化）
- [ ] AI 回答格式和 Prompt 优化
- [ ] 设计策略章节支持可勾选的独立生成
- [ ] 项目保存/读取功能（localStorage）
- [ ] 支持自定义章节排列顺序
